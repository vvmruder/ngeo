!function(t){function e(e){for(var n,r,l=e[0],s=e[1],c=e[2],m=0,d=[];m<l.length;m++)r=l[m],o[r]&&d.push(o[r][0]),o[r]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);for(u&&u(e);d.length;)d.shift()();return a.push.apply(a,c||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],n=!0,l=1;l<i.length;l++){var s=i[l];0!==o[s]&&(n=!1)}n&&(a.splice(e--,1),t=r(r.s=i[0]))}return t}var n={},o={2:0};var a=[];function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var l=window.webpackJsonp=window.webpackJsonp||[],s=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var u=s;a.push([321,0]),i()}({316:function(t,e,i){"use strict";i.r(e);i(443);var n=i(21),o=i(27),a=i(20),r=i(32),l=i(2),s=i(139),c=i(212),u={Permalink3dParam:{ENABLED:"3d_enabled",LON:"3d_lon",LAT:"3d_lat",ELEVATION:"3d_elevation",HEADING:"3d_heading",PITCH:"3d_pitch",PREFIX:"3d_"}},m=u,d=i(250);var h=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.manager_,this.ngeoDebounce_=e,this.ngeoLocation_=i,this.ngeoStateManager_=n}return t.$inject=["ngeoDebounce","ngeoLocation","ngeoStateManager"],t.prototype.initialize=function(t){var e=this;this.manager_=t,this.manager_.on("load",function(){e.cameraToState_()}),this.ngeoStateManager_.getInitialBooleanValue("3d_enabled")&&this.initialStateToCamera_()},t.prototype.getManager=function(){return this.manager_},t.prototype.initialStateToCamera_=function(){var t=this.ngeoStateManager_,e=t.getInitialNumberValue(m.Permalink3dParam.LON),i=t.getInitialNumberValue(m.Permalink3dParam.LAT),n=t.getInitialNumberValue(m.Permalink3dParam.ELEVATION),o=t.getInitialNumberValue(m.Permalink3dParam.HEADING)||0,a=t.getInitialNumberValue(m.Permalink3dParam.PITCH)||0;return l.a.assert(void 0!==e),l.a.assert(void 0!==i),l.a.assert(void 0!==n),this.manager_.set3dWithView(e,i,n,o,a)},t.prototype.cameraToState_=function(){var t=this,e=this.manager_.getOl3d().getCesiumScene().camera;e.moveEnd.addEventListener(this.ngeoDebounce_(function(){var i,n=e.positionCartographic;t.ngeoStateManager_.updateState(((i={})[m.Permalink3dParam.ENABLED]=!0,i[m.Permalink3dParam.LON]=Cesium.Math.toDegrees(n.longitude).toFixed(5),i[m.Permalink3dParam.LAT]=Cesium.Math.toDegrees(n.latitude).toFixed(5),i[m.Permalink3dParam.ELEVATION]=n.height.toFixed(0),i[m.Permalink3dParam.HEADING]=Cesium.Math.toDegrees(e.heading).toFixed(3),i[m.Permalink3dParam.PITCH]=Cesium.Math.toDegrees(e.pitch).toFixed(3),i))},1e3,!0)),this.manager_.on("toggle",function(e){e.target.is3dEnabled()||t.remove3dState_()})},t.prototype.remove3dState_=function(){var t=this;this.ngeoLocation_.getParamKeysWithPrefix(m.Permalink3dParam.PREFIX).forEach(function(e){t.ngeoStateManager_.deleteParam(e)})},t}();h.module=angular.module("ngeoOlcsService",[s.a.name,c.a.module.name,d.a.module.name]).service("ngeoOlcsService",h);var g=h,f=i(74),p=i(68);b.$inject=["$attrs","ngeoOlcsControls3dTemplateUrl"];var v=angular.module("ngeoOlcsControls3d",[]);var _=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.element_=e,this.ol3dm,this.minTilt,this.maxTilt,this.tiltRightEl_,this.tiltLeftEl_,this.rotation3dEl_,this.angle3dEl_,this.previousRotation_,this.previousViewMatrix_,this.animationFrameRequestId_,this.olcsService_=i}return t.$inject=["$element","ngeoOlcsService"],t.prototype.updateWidget_=function(){var t,e,i=this,n=this.ol3dm.getOl3d().getOlView().getRotation();t=this.previousRotation_,e=n,Number.isFinite(e)&&(!Number.isFinite(t)||Math.abs(e-t)>.05)&&(this.rotateElement_(this.rotation3dEl_,n),this.previousRotation_=n);var o=this.ol3dm.getCesiumViewMatrix();if(!Cesium.Matrix4.equalsEpsilon(this.previousViewMatrix_,o,1e-5)){var a=this.ol3dm.getTiltOnGlobe();if(Number.isFinite(a||0)){this.rotateElement_(this.angle3dEl_,a),this.previousViewMatrix_=Cesium.Matrix4.clone(o);a-this.minTilt<.01?this.tiltRightEl_.addClass("ngeo-right-inactive"):this.tiltRightEl_.hasClass("ngeo-right-inactive")&&this.tiltRightEl_.removeClass("ngeo-right-inactive"),this.maxTilt-a<.01?this.tiltLeftEl_.addClass("ngeo-left-inactive"):this.tiltLeftEl_.hasClass("ngeo-left-inactive")&&this.tiltLeftEl_.removeClass("ngeo-left-inactive")}}this.animationFrameRequestId_=requestAnimationFrame(function(){return i.updateWidget_()})},t.prototype.$onDestroy=function(){this.animationFrameRequestId_&&cancelAnimationFrame(this.animationFrameRequestId_)},t.prototype.$onInit=function(){void 0===this.minTilt&&(this.minTilt=0),void 0===this.maxTilt&&(this.maxTilt=7*Math.PI/16),this.ol3dm||(this.ol3dm=l.a.assert(this.olcsService_.getManager())),this.tiltRightEl_=this.element_.find(".ngeo-tilt-right"),this.tiltLeftEl_=this.element_.find(".ngeo-tilt-left"),this.rotation3dEl_=this.element_.find(".ngeo-rotation3d"),this.angle3dEl_=this.element_.find(".ngeo-angle3d"),this.updateWidget_()},t.prototype.rotateElement_=function(t,e){var i="rotate("+e+"rad)";t.css({"-moz-transform":i,"-webkit-transform":i,"-o-transform":i,"-ms-transform":i,transform:i})},t.prototype.rotate=function(t){t=Cesium.Math.toRadians(t),this.ol3dm.setHeading(t)},t.prototype.tilt=function(t){t=Cesium.Math.toRadians(t);var e=this.ol3dm.getTiltOnGlobe();e+t<this.minTilt?t=this.minTilt-e:e+t>this.maxTilt&&(t=this.maxTilt-e);var i=this.ol3dm.getCesiumScene();p.a.rotateAroundBottomCenter(i,t)},t.prototype.zoom=function(t){var e=this.ol3dm.getOlView(),i=e.getResolution(),n=e.constrainResolution(i,t);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:n,duration:250,easing:f.b})},t}();function b(t,e){if(e)return e;var i=t.ngeoOlcsControls3dTemplateUrl;return i||"ngeo/olsc/controls3d"}v.run(["$templateCache",function(t){t.put("ngeo/olsc/controls3d",i(320))}]);var E={bindings:{minTilt:"<?",maxTilt:"<?",ol3dm:"<?"},controller:_,templateUrl:b};v.component("ngeoOlcsControls3d",E),v.value("ngeoOlcsControls3dTemplateUrl","");var P=v,C=angular.module("ngeoOlcsModule",[P.name,g.module.name]),y=i(26);var T=function(t){function e(i,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this,i,o));return a.rootScope_=n,a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.toggle3d=function(){var e=this;return t.prototype.toggle3d.call(this).then(function(){e.rootScope_.$apply()})},e}(i(302).a),w={};w.module=angular.module("app",["gettext",y.a.name,C.name]),w.MainController=function(t,e){this.map=new n.a({layers:[new a.a({source:new r.a})],view:new o.a({center:[0,0],zoom:4})});this.ol3dm=new T("../node_modules/@camptocamp/cesium/Build/Cesium/Cesium.js",t,{map:this.map}),e.initialize(this.ol3dm)},w.MainController.$inject=["$rootScope","ngeoOlcsService"],w.module.controller("MainController",w.MainController);e.default=w},320:function(t,e){t.exports='<div class=ngeo-tools> <div class=ngeo-angle><div class=ngeo-angle3d></div></div> <button class="ngeo-left ngeo-tilt-left" ng-click=$ctrl.tilt(5)></button> <button class="ngeo-right ngeo-tilt-right" ng-click=$ctrl.tilt(-5)></button> </div> <div class=ngeo-zoom> <button class=ol-zoom-in ng-click=$ctrl.zoom(1)></button> <button class=ol-zoom-out ng-click=$ctrl.zoom(-1)></button> </div> <div class=ngeo-tools> <div class=ngeo-rotation><div class=ngeo-rotation3d></div></div> <button class=ngeo-left ng-click=$ctrl.rotate(-15)></button> <button class=ngeo-right ng-click=$ctrl.rotate(15)></button> </div> '},321:function(t,e,i){i(56),i(54),t.exports=i(316)},443:function(t,e){}});
//# sourceMappingURL=simple3d.f01ea884282d412b9134.js.map